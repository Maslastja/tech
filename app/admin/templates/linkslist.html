{% extends 'admin.html' %}
{% block body %}
<script>
	function ch_type() {
		if (window.sessionStorage) {
			sessionStorage.setItem('typelink', document.getElementById("typelink").value);
		}	
	}
	function get_links() {
		if ($('#list').length > 0) {
			$('#list').empty();	
			if (window.sessionStorage) {
				if (sessionStorage.getItem('typelink') != null) {
					document.getElementById("typelink").value = sessionStorage.getItem('typelink');	
				}
			}
			var valtype = document.getElementById("typelink").value;
			
			//запрос на получение значений по отбору БД		
			$.ajax({
			type: 'get',
			url: '/admin/get_links?typelink='+valtype+'',
			crossDomain: true
			}).done(function(resp) {
				var query = JSON.parse(resp);	
				for (el in query) {
					$('#list').append(`<tr>
											  	<td>${query[el]['linkname']}</td>
								 				<td>${query[el]['fullname']}</td>
								 				<td>${query[el]['typelink']}</td>
												<td class='text-center'>
													<button type='submit' class='btn btn-link' name='changesub' value=${query[el]['id']}>
														<i class='icon icon-edit'></i>
													</button>					
												</td>						
												<td class='text-center'>
													<button type='submit' class='btn btn-link' name='delsub' value=${query[el]['id']}>
														<i class='icon icon-delete'></i>
													</button>					
												</td>						
											  </tr>`);		
				}			
			});
		}		
	}
</script>

<form action='' method='post' novalidate>
	<div class='columns'>	
		<div class='column col-8 col-mr-auto'>
			<button type='submit' class='btn btn-link' name='addlink'><i class='icon icon-plus'></i> Добавить</button>
			<div class='column col-4'>
				<label for='typeotd'>тип ссылок</label>
				<select id='typelink' name='typelink' class='form-select' onchange='ch_type(); get_links();'>
				<option value=''>не выбрано</option>	
				{% for el in types %}
					<option value={{ el }}>{{ types[el] }}</option>	
				{% endfor %}
				</select>
			</div>
			{% with messages = get_flashed_messages() %}
			   {% if messages %}
			      {% for message in messages %}
			         {{ message }}
			      {% endfor %}
			   {% endif %}
			{% endwith %}
			<table id='listlinks' class='table table-striped table-hover'>
				<thead>				
				<tr class='text-center'>
					<th>наименование</th>
					<th>полный адрес</th>
					<th>тип</th>
					<th>активная</th>
					<th></th>
					<th></th>
				</tr>
				</thead>
				<tbody id="list">				
				{#{% for l in links %}
					<tr>
						<td>{{ l.linkname }}</td>
						<td>{{ l.fullname }}</td>
						<td>{{ l.typelink }}</td>
						{% if l.isactive == True %}						
							<td class='text-center'>Да</td>
						{% else %}
							<td class='text-center'>Нет</td>
						{% endif %}
						<td class='text-center'>
							<button type='submit' class='btn btn-link' name='changesub' value={{ l.id }}>
								<i class='icon icon-edit'></i>
							</button>					
						</td>						
						<td class='text-center'>
							<button type='submit' class='btn btn-link' name= 'delsub' value = {{ l.id }}>
								<i class='icon icon-delete'></i>
							</button>					
						</td>						
					</tr>
				{% endfor %}#}
				</tbody>
			</table>        
		</div> 
	</div>
</form>
{% endblock %}